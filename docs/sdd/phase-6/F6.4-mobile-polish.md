# F6.4 Mobile Polish SDD

## Metadata
- Feature: F6.4 Mobile Polish
- Phase: 6
- Status: Complete
- Owner: Mobile App
- Updated: 2026-02-16

## Goals
- Add semantic haptic feedback patterns for common interactions.
- Add offline mode detection with visual banner indicator.
- Add swipeable row gesture component for list items.
- Add comprehensive accessibility helpers for consistent a11y props.
- Enhance existing UI components (Button, Input) with accessibility attributes.
- Integrate OfflineBanner into the root app layout.

## Architecture

### Haptic Patterns (`apps/mobile/src/lib/hapticPatterns.ts`)
- `hapticSuccess`, `hapticWarning`, `hapticError` - Notification feedback types
- `hapticLight`, `hapticMedium`, `hapticHeavy` - Impact feedback levels
- `hapticSelection` - Selection feedback for pickers/toggles
- `hapticConfirm` - Double-tap pattern: light then medium with 80ms gap
- `hapticDestructive` - Warning then heavy with 100ms gap
- All patterns are web-safe (no-op on web platform)

### Network Status (`apps/mobile/src/lib/useNetworkStatus.ts`)
- `useNetworkStatus()` hook returns `isConnected`, `isInternetReachable`, and `type`
- On web: uses `navigator.onLine` with online/offline event listeners
- On native: dynamically loads `@react-native-community/netinfo` if available
- Falls back to AppState-based detection if NetInfo not installed

### OfflineBanner (`apps/mobile/src/components/ui/OfflineBanner.tsx`)
- Animated banner that appears when network is disconnected
- FadeInUp/FadeOutUp transitions via react-native-reanimated
- Renders WifiOff icon with "No internet connection" text
- Includes accessibilityRole="alert" for screen readers
- Integrated at root layout level (appears above all screens)

### SwipeableRow (`apps/mobile/src/components/ui/SwipeableRow.tsx`)
- Gesture-driven swipeable row using react-native-gesture-handler
- Reveals action buttons (delete, archive) on left swipe
- Spring-based animation with configurable threshold (default 40%)
- Haptic feedback on open (light) and destructive actions (warning + heavy)
- Each action button has accessibilityRole="button" and label

### Accessibility Helpers (`apps/mobile/src/lib/accessibility.ts`)
- `a11yButton(label, hint?)` - Button role with label and optional hint
- `a11yLink(label)` - Link role
- `a11yHeader(label)` - Header role
- `a11yImage(label)` - Image role
- `a11yToggle(label, checked)` - Switch role with checked state
- `a11yTab(label, selected)` - Tab role with selected state
- `a11yTextInput(label, hint?)` - Text input accessibility
- `a11yProgressBar(label, value, max?)` - Progress bar with computed label

### Enhanced Components
- `Button.tsx` - Added `accessibilityRole="button"` and `accessibilityState={{ disabled }}`
- `Input.tsx` - Added `accessibilityLabel` from label or placeholder, `accessibilityRole="alert"` on error text

### Integration
- `app/_layout.tsx` - Added OfflineBanner import and rendering above Stack navigator

## Testing Plan
- Unit: hapticPatterns functions are web-safe (no crash on Platform.OS === 'web')
- Unit: accessibility helpers produce correct role/label/state objects
- Unit: useNetworkStatus returns sensible defaults
- Integration: OfflineBanner shows/hides based on network state
- Integration: SwipeableRow reveals actions and fires callbacks
- Integration: Button and Input render correct accessibility props
- E2E: swipe-to-delete gesture completes with haptic feedback
- E2E: offline banner appears when connectivity is lost
