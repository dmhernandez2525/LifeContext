# F6.3 Push Notifications SDD

## Metadata
- Feature: F6.3 Push Notifications
- Phase: 6
- Status: Complete
- Owner: Mobile App
- Updated: 2026-02-16

## Goals
- Add local push notification infrastructure via expo-notifications.
- Support notification categories: journal reminders, streak alerts, insight notifications, weekly summaries, inactivity nudges, and milestones.
- Schedule recurring notifications (daily journal reminder, weekly summary).
- Deep link from notification taps to relevant app screens.
- Provide a full notification preferences UI with per-category toggles.
- Support quiet hours configuration.
- Track scheduled notifications for management and cancellation.

## Architecture

### Notification Layer (`apps/mobile/src/notifications/`)
- `notificationTypes.ts` - Type definitions: NotificationCategory, NotificationPreferences, ScheduledNotification, default preferences.
- `notificationService.ts` - Core service: permission requests, notification handler setup, scheduling functions (daily, weekly, time-interval triggers), cancellation by ID or category, badge management, scheduled notification tracking (capped at 50 entries).
- `useNotifications.ts` - React hook: permission management, deep link handling on notification tap, preference updates with automatic schedule sync.
- `index.ts` - Barrel export for all notification APIs and types.

### UI (`apps/mobile/app/settings/notifications.tsx`)
- Full notification preferences screen with:
  - Master enable/disable toggle
  - Journal reminder toggle with configurable time selector (13 time options)
  - Streak alert toggle
  - Insight notification toggle
  - Weekly summary toggle
  - Inactivity nudge toggle with configurable day threshold (1, 2, 3, 5, 7 days)
  - Quiet hours toggle with start/end times

### Integration Points
- `apps/mobile/app/settings/index.tsx` - Added notifications entry in settings menu.
- `apps/mobile/app/settings/_layout.tsx` - Added notifications screen to Stack navigator.

## Notification Types

| Category | Trigger | Deep Link | Default |
|----------|---------|-----------|---------|
| journal-reminder | Daily at configurable time | /(tabs)/journal | On, 8:00 PM |
| streak-alert | Daily at 9:00 PM | /recording | On |
| insight-ready | Immediate (when insight found) | /(tabs)/insights | On |
| weekly-summary | Weekly, Monday 9:00 AM | /(tabs)/insights | On |
| inactivity-nudge | After N days of inactivity | /recording | On, 3 days |
| milestone | Immediate (on milestone) | /(tabs) | On |

## Storage Keys
- `lcc-notification-prefs` (MMKV) - User notification preferences
- `lcc-scheduled-notifications` (MMKV) - Tracked scheduled notifications (max 50)

## Dependencies Added
- `expo-notifications` - Local and push notification support
- `expo-task-manager` - Background task management

## Testing Plan
- Unit: notification scheduling functions produce correct trigger configurations
- Unit: preference save/load round-trips correctly
- Unit: cancellation by category removes correct notifications
- Unit: scheduled notification tracking respects 50-entry cap
- Integration: permission request flow (granted/denied)
- Integration: deep link navigation on notification tap
- Integration: preference update triggers schedule resync
- E2E: notification settings toggles persist across screen navigation
- E2E: time selector and inactivity day picker work correctly
