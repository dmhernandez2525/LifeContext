# F5.1 Onboarding Refinement SDD

## Metadata
- Feature: F5.1 Onboarding Refinement
- Phase: 5
- Status: In Progress
- Owner: Web App
- Updated: 2026-02-15

## Goals
- Add skip confirmation before onboarding is skipped.
- Track onboarding analytics: completion rate, drop-off point, and time per step.
- Persist onboarding progress in localStorage and resume sessions.
- Add contextual "why this matters" help per step.
- Support personalized paths from user intent selection (journaling, therapy, legacy).
- Add A/B variant assignment infrastructure for onboarding flow variants.
- Keep animated transitions smooth using Framer Motion spring transitions.
- Add quick-start mode for minimal setup.
- Provide a progress indicator with current and remaining steps.
- Add a post-onboarding summary screen.

## Constraints
- No file can exceed 300 lines.
- No forbidden patterns (`any`, `@ts-ignore`, `eslint-disable`, `console.*`, empty handlers).
- Preserve zero-knowledge architecture language and behavior.
- Keep onboarding completion flag compatible with existing key: `lcc-onboarding-complete`.

## UX Flow
1. Welcome step.
2. Intent selection step.
3. Dynamic steps determined by intent + mode (full or quick).
4. Summary step.
5. Complete onboarding.

Skip path:
1. User clicks skip.
2. Confirmation dialog appears.
3. If confirmed, onboarding marks skipped and exits.

Resume path:
1. User closes app mid-onboarding.
2. Draft progress persists in `localStorage`.
3. On next launch, onboarding resumes from saved step.

## State Model
- `OnboardingDraft`
  - `sessionId`
  - `variant`
  - `intent`
  - `mode`
  - `currentStepIndex`
  - `passcodeConfirmed`
  - `dataReclamationEnabled`
  - `startedAt`
  - `updatedAt`
- `OnboardingAnalyticsStore`
  - List of session records.
  - Each session includes status (`completed` or `skipped`), step durations, drop-off step, and timestamps.

## Storage Keys
- `lcc-onboarding-complete`
- `lcc-onboarding-progress`
- `lcc-onboarding-analytics`
- `lcc-onboarding-variant`

## Architecture
- `OnboardingWizard.tsx`
  - Orchestrates flow, transitions, and user actions.
- `onboarding/types.ts`
  - Shared step, intent, mode, variant, and analytics types.
- `onboarding/storage.ts`
  - Persist/load/clear draft progress.
- `onboarding/analytics.ts`
  - Session and step analytics tracking.
- `onboarding/flow.ts`
  - Build step sequence by intent + mode + variant.
- `onboarding/OnboardingSkipDialog.tsx`
  - Skip confirmation modal.
- `onboarding/OnboardingProgress.tsx`
  - Current step and remaining indicator.
- `onboarding/OnboardingHelpTooltip.tsx`
  - Contextual explanation panel.
- `onboarding/OnboardingStepContent.tsx`
  - Step-specific UI.

## A/B Test Infrastructure
- On first onboarding session, assign variant `control` or `streamlined`.
- Persist variant in localStorage for deterministic behavior.
- Include variant in all analytics records.
- Variant influences copy and quick-start placement.

## Analytics Events
- `session_started`
- `step_viewed`
- `step_advanced`
- `session_skipped`
- `session_completed`

Derived metrics:
- Completion rate.
- Average time per step.
- Drop-off distribution by step.

## Testing Plan
- E2E: Skip confirmation flow.
- E2E: Progress persistence across refresh/session restart.
- E2E: Personalized path selection by intent.
- E2E: Completion event recorded in analytics store.

## Rollout Notes
- Backward compatible with existing onboarding completion check.
- Existing users with `lcc-onboarding-complete=true` bypass onboarding unchanged.
